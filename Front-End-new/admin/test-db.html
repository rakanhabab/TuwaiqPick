<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
    <style>
        body { font-family: 'Tajawal', sans-serif; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h1>
    <div id="results"></div>

    <script type="module">
        import { db } from '../js/database.js';

        const resultsDiv = document.getElementById('results');

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            resultsDiv.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        async function testDatabase() {
            try {
                addResult('Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');

                // Test 1: Check Supabase connection
                addResult('Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase...', 'info');
                const { data: testData, error: testError } = await db.supabase
                    .from('users')
                    .select('count')
                    .limit(1);
                
                if (testError) {
                    addResult(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${testError.message}`, 'error');
                    return;
                }
                addResult('âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase ÙŠØ¹Ù…Ù„', 'success');

                // Test 2: Get branches
                addResult('Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù„Ø¨ Ø§Ù„ÙØ±ÙˆØ¹...', 'info');
                const branches = await db.getBranches();
                addResult(`âœ… ØªÙ… Ø¬Ù„Ø¨ ${branches.length} ÙØ±Ø¹`, 'success');
                console.log('Branches:', branches);

                // Test 3: Get products
                addResult('Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...', 'info');
                const products = await db.getProducts();
                addResult(`âœ… ØªÙ… Ø¬Ù„Ø¨ ${products.length} Ù…Ù†ØªØ¬`, 'success');
                console.log('Products:', products);

                // Test 4: Get invoices
                addResult('Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù„Ø¨ Ø§Ù„ÙÙˆØ§ØªÙŠØ±...', 'info');
                const invoices = await db.getAllInvoices();
                addResult(`âœ… ØªÙ… Ø¬Ù„Ø¨ ${invoices.length} ÙØ§ØªÙˆØ±Ø©`, 'success');
                console.log('Invoices:', invoices);

                // Test 5: Get inventory
                addResult('Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†...', 'info');
                const inventory = await db.getInventoryQuantities();
                addResult(`âœ… ØªÙ… Ø¬Ù„Ø¨ ${inventory.length} Ø³Ø¬Ù„ Ù…Ø®Ø²ÙˆÙ†`, 'success');
                console.log('Inventory:', inventory);

                addResult('ğŸ‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª!', 'success');

            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ Ø¹Ø§Ù…: ${error.message}`, 'error');
                console.error('Test error:', error);
            }
        }

        // Run test when page loads
        testDatabase();
    </script>
</body>
</html>
